<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Vecna</title>

<link href="https://fonts.googleapis.com/css2?family=Creepster&display=swap" rel="stylesheet">

<style>
*{
    margin:0;
    padding:0;
    box-sizing:border-box;
}

html{
    height:100%;
    background: url('bg55.png') center/cover no-repeat fixed;
}

body{
    margin:0;
    height:100%;
    overflow:hidden;
    background: transparent;
    font-family:'Creepster', cursive;
}

canvas{
    position:absolute;
    inset:0;
    pointer-events:none;
    background: transparent;
}
.line{
    height:2px;
    width:1000px;
    color: #F2E6C9;
-webkit-text-stroke: 1px #000;
text-shadow:
  0 0 10px #000,
  0 0 25px #000;
    margin:8px auto;
    box-shadow:0 0 8px rgb(38, 15, 15);
}
.center-logo{
    width:550px;
    filter: drop-shadow(0 0 30px #0e0f0f);
}
/* title */
.title{
    font-family: 'ITC Benguiat', serif;
    outline-color: rgb(250, 200, 0);
    font-size: 40px;
    letter-spacing: 6px;
    color: #0b0101;
    text-shadow:
        0 0 8px #090909,
        0 0 25px #060606,
        0 0 40px #0b0b0b;
    position: absolute;
    top: 6%;
    left: 10%;
    width: 80%;
    text-align: center;
    -webkit-text-stroke: 1px #ff1a1a;
}
.login-btn{
    position:fixed;
    top:450px;
    right:525px;
    padding:10px 22px;
    border:2px solid #0b1314;
    color:#ff0000;
    text-decoration:none;
    font-weight:600;
    letter-spacing:1px;
    border-radius:6px;
    z-index:10;
    transition:0.3s;
    box-shadow:0 0 10px #abacac;
    filter: drop-shadow(0 0 10px #ac232e);
    text-shadow:
        0 0 8px #090909,
        0 0 25px #060606,
        0 0 40px #0b0b0b;
    animation: floatLogo 4s ease-in-out infinite;
}
.login-btn:hover{
    background:#b46307;
    color:#ecbabf;
    box-shadow:0 0 25px #a95802c9;
}

.contnt{
    position:absolute;
    top:25%;
    width:100%;
    text-align:center;
    color:rgb(203, 19, 19);
    letter-spacing:8px;
    font-weight:200;
    font-size:3rem;
    text-shadow:0 0 40px rgba(128, 9, 9, 0.8);
    animation: fadein 4s ease forwards;
    opacity:0;
}
@keyframes fadein{
    to{ opacity:1; }
}

/* Responsive */
@media(max-width:768px){
    .content{
        font-size:1rem;
        letter-spacing:4px;
    }
}

.tagline{
    position:fixed;
    bottom:470px;
    width:100%;
    text-align:center;
    color:#021c2c;
    font-size: 30px;
    letter-spacing:4px;
    text-shadow:0 0 15px #dab606;
}

/* ===== PROMPT BOX ===== */
.prompt-box{
    position:absolute;
    top:50%;
    left:50%;
    transform:translate(-50%,-50%);
    width:60%;
    max-width:800px;
    text-align:center;
    z-index:5;
}

.prompt-label{
    display:block;
    margin-bottom:18px;
    font-size:28px;
    outline-color: rgb(16, 16, 16);
    letter-spacing:6px;
    color:transparent;
    -webkit-text-stroke:3px #ed8012;
    text-shadow:
        0 0 8px #090909,
        0 0 25px #060606,
        0 0 40px #0b0b0b;
}

.prompt-box textarea{
    width:100%;
    height:120px;
    border-radius:40px;
    padding:25px;
    font-size:18px;
    border:2px solid red;
    background:rgba(0,0,0,0.75);
    color:white;
    outline:none;
    resize:none;
    box-shadow:0 0 30px rgb(45, 7, 7);
    transition:0.3s;
}

.prompt-box textarea:focus{
    box-shadow:0 0 50px red;
}

#result{
    position:absolute;
    bottom:40px;
    width:100%;
    text-align:center;
    z-index:20;
}

#result img{
    width:380px;
    border-radius:20px;
    box-shadow:0 0 40px red;
}

.popup-overlay{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.9);
  display:none;
  justify-content:center;
  align-items:center;
  z-index:9999;
}

.blast-bg{
  position:absolute;
  width:320px;
  height:320px;
  border-radius:50%;
  background:radial-gradient(circle, #696767, transparent 60%);
  animation:blast 1s ease-out forwards;
}

.popup-box{
  position:relative;
  width:430px;
  padding:30px;
  text-align:center;
  background:#0d0d0d;
  color:rgb(151, 11, 11);
  border-radius:15px;
  box-shadow:0 0 50px rgb(141, 6, 6);
  animation:zoomIn 0.5s ease forwards;
}

.popup-image{
  width:130px;
  margin-bottom:15px;
}

.popup-box button{
  margin-top:18px;
  padding:10px 25px;
  border:none;
  background:rgb(169, 6, 6);
  border-radius:8px;
  font-weight:bold;
  cursor:pointer;
}

@keyframes blast{
  0%{transform:scale(0.2);opacity:1;}
  100%{transform:scale(5);opacity:0;}
}

@keyframes zoomIn{
  from{transform:scale(0);opacity:0;}
  to{transform:scale(1);opacity:1;}
}

.confetti{
    position: absolute;
    width: 8px;
    height: 14px;
    opacity: 0.9;
    animation: fall linear forwards;
}

@keyframes fall{
    0%{
        transform: translateY(-10vh) rotate(0deg);
    }
    100%{
        transform: translateY(110vh) rotate(720deg);
    }
}

@media (max-width: 767px){

  body{
    overflow:hidden;
  }

  /* TITLE */
  .title{
    font-size:24px;
    letter-spacing:3px;
    top:4%;
    left:5%;
    width:90%;
  }

  .line{
    width:220px;
  }

  /* TAGLINE */
  .tagline{
    bottom:78%;
    font-size:18px;
    letter-spacing:2px;
  }

  /* PROMPT */
  .prompt-box{
    width:90%;
    top:55%;
  }

  .prompt-label{
    font-size:16px;
    letter-spacing:2px;
    -webkit-text-stroke:1.5px #ed8012;
  }

  .prompt-box textarea{
    height:90px;
    font-size:14px;
    padding:16px;
    border-radius:22px;
  }

  /* BUTTON */
  .login-btn{
    top:auto;
    right:50%;
    bottom:18%;
    transform:translateX(50%);
    font-size:14px;
    padding:8px 18px;
  }

  /* RESULT IMAGE */
  #result img{
    width:220px;
  }

  /* POPUP */
  .popup-box{
    width:85%;
    padding:20px;
  }

  /* PARTICLES (PERF BOOST) */
  canvas{
    opacity:0.8;
  }
}

@media (min-width:768px) and (max-width:1024px){

  .title{
    font-size:32px;
    letter-spacing:5px;
    top:5%;
  }

  .line{
    width:420px;
  }

  .tagline{
    bottom:65%;
    font-size:22px;
  }

  .prompt-box{
    width:75%;
    top:55%;
  }

  .prompt-label{
    font-size:22px;
    letter-spacing:4px;
  }

  .prompt-box textarea{
    height:110px;
    font-size:16px;
  }

  .login-btn{
    top:auto;
    right:50%;
    bottom:16%;
    transform:translateX(50%);
    font-size:15px;
    padding:10px 22px;
  }

  #result img{
    width:300px;
  }

  .popup-box{
    width:380px;
  }
}

@media (min-width:1025px){

  .title{
    font-size:40px;
  }

  .line{
    width:1000px;
  }

  .prompt-box{
    width:60%;
  }

  .login-btn{
    top:450px;
    right:525px;
    transform:none;
  }

  #result img{
    width:380px;
  }
}


</style>
</head>

<body>

<a href="#" class="login-btn" onclick="finalBlast()">CLOSE THE PORTAL</a>


<canvas id="particles"></canvas>
<div class="logo">
    <div class="line"></div>
    <div class="title">ROUND 3</div>
    <div class="line"></div>
</div>
<div class="logo1">
    <div class="tagline">THEME : STRANGER THINGS</div>
    <div class="title"></div>
    <div class="tagline"></div>
</div>
<div class="prompt-box">
    <label class="prompt-label">IN THE ABYSS, ONLY SOUND SHOWS THE WAY</label>
    <textarea placeholder="Stop Abyss From Falling Down...!"></textarea>
</div>
<div id="result"></div>

<div id="resultPopup" class="popup-overlay">
  <div class="blast-bg"></div>

  <div class="popup-box">
    <h2>HAWKINS IS SAFE</h2>
    <p>You closed the Upside Down forever.</p>
    <button onclick="restartGame()">BACK TO HAWKINS</button>
  </div>
</div>
<div id="confetti-container"></div>

<script>
async function generateImage(){
    const prompt = document.querySelector("textarea").value;
    const result = document.getElementById("result");

    if(!prompt){
        result.innerHTML = "Type a prompt first...";
        return;
    }

    result.innerHTML = "Summoning from the Upside Down...";

    try{
        const res = await fetch("http://localhost:3000/generate", {
            method:"POST",
            headers:{"Content-Type":"application/json"},
            body: JSON.stringify({prompt})
        });

        const data = await res.json();
        result.innerHTML = `<img src="${data.image}" />`;
    }
    catch(e){
        result.innerHTML = "Connection to portal failed...";
    }
}

const canvas = document.getElementById('particles');
const ctx = canvas.getContext('2d');

canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let particles = [];

class Particle{
    constructor(){
        this.x = Math.random()*canvas.width;
        this.y = Math.random()*canvas.height;
        this.size = Math.random()*2+1;
        this.speed = Math.random()*0.4+0.2;
        this.opacity = Math.random();
    }
    update(){
        this.y -= this.speed;
        if(this.y < 0){
            this.y = canvas.height;
            this.x = Math.random()*canvas.width;
        }
    }
    draw(){
        ctx.fillStyle = `rgba(255,40,40,${this.opacity})`;
        ctx.beginPath();
        ctx.arc(this.x,this.y,this.size,0,Math.PI*2);
        ctx.fill();
    }
}

function init(){
    for(let i=0;i<350;i++){
        particles.push(new Particle());
    }
}

function animate(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    particles.forEach(p=>{
        p.update();
        p.draw();
    });
    requestAnimationFrame(animate);
}

init();
animate();

window.addEventListener('resize', ()=>{
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
});

function finalBlast(){
  const popup = document.getElementById("resultPopup");
  popup.style.display = "flex";

  const blast = popup.querySelector(".blast-bg");
  blast.style.animation = "none";
  void blast.offsetWidth;
  blast.style.animation = "blast 1s ease-out forwards";
}

function restartGame(){
  document.getElementById("resultPopup").style.display = "none";
  window.location.href = "round1.html";
}
window.addEventListener('resize', ()=>{
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
});

function crossPortal(){
  showPopup();
}

function showPopup(){
  const popup = document.getElementById("resultPopup");
  popup.style.display = "flex";

  const blast = popup.querySelector(".blast-bg");
  blast.style.animation = "none";
  void blast.offsetWidth;
  blast.style.animation = "blast 1s ease-out forwards";

  popup.style.display = "flex";

  // confetti
  for(let i=0;i<80;i++){
    let conf = document.createElement("div");
    conf.className = "confetti";
    conf.style.left = Math.random()*100 + "vw";
    conf.style.top = "-20px";
    conf.style.background = `hsl(${Math.random()*360},100%,50%)`;
    conf.style.animationDuration = (Math.random()*2+1)+"s";
    popup.appendChild(conf);

    setTimeout(()=>conf.remove(),2500);
  }
}
</script>

</body>
</html>
